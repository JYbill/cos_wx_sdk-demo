# ä½¿ç”¨è…¾è®¯äº‘å¯¹è±¡äº‘å­˜å‚¨è¿›è¡Œä¸Šä¼ æ–‡ä»¶(Javaä¸´æ—¶ç§˜é’¥)

## ä½¿ç”¨å·²ç»åœ¨è…¾è®¯äº‘DNSè§£æä¸‹çš„åŸŸå

+ ç™»é™†[å¯¹è±¡å­˜å‚¨æ§åˆ¶å°](./readme-imghttps://console.cloud.tencent.com/cos5)

  ![ä½¿ç”¨è…¾è®¯äº‘å¯¹è±¡äº‘å­˜å‚¨è¿›è¡Œä¸Šä¼ æ–‡ä»¶(Javaä¸´æ—¶ç§˜é’¥)1](./readme-img/ä½¿ç”¨è…¾è®¯äº‘å¯¹è±¡äº‘å­˜å‚¨è¿›è¡Œä¸Šä¼ æ–‡ä»¶(Javaä¸´æ—¶ç§˜é’¥)1.png)

  ![ä½¿ç”¨è…¾è®¯äº‘å¯¹è±¡äº‘å­˜å‚¨è¿›è¡Œä¸Šä¼ æ–‡ä»¶(Javaä¸´æ—¶ç§˜é’¥)2](./readme-img/ä½¿ç”¨è…¾è®¯äº‘å¯¹è±¡äº‘å­˜å‚¨è¿›è¡Œä¸Šä¼ æ–‡ä»¶(Javaä¸´æ—¶ç§˜é’¥)2.png)

+ è¿›å…¥è‡ªå·±çš„åŸŸååˆ—è¡¨ [è‡ªå·±çš„åŸŸååˆ—è¡¨https://console.dnspod.cn/dns/list](./readme-imghttps://console.dnspod.cn/dns/list)

![ä½¿ç”¨è…¾è®¯äº‘å¯¹è±¡äº‘å­˜å‚¨è¿›è¡Œä¸Šä¼ æ–‡ä»¶(Javaä¸´æ—¶ç§˜é’¥)3](./readme-img/ä½¿ç”¨è…¾è®¯äº‘å¯¹è±¡äº‘å­˜å‚¨è¿›è¡Œä¸Šä¼ æ–‡ä»¶(Javaä¸´æ—¶ç§˜é’¥)3.png)

+ ä¿å­˜ -> æµ‹è¯•

![ä½¿ç”¨è…¾è®¯äº‘å¯¹è±¡äº‘å­˜å‚¨è¿›è¡Œä¸Šä¼ æ–‡ä»¶(Javaä¸´æ—¶ç§˜é’¥)4](./readme-img/ä½¿ç”¨è…¾è®¯äº‘å¯¹è±¡äº‘å­˜å‚¨è¿›è¡Œä¸Šä¼ æ–‡ä»¶(Javaä¸´æ—¶ç§˜é’¥)4.png)

æµ‹è¯•è®¿é—®å›¾ç‰‡ï¼ˆå·²ç»ä¸Šä¼ äº†çš„...ï¼‰

![ä½¿ç”¨è…¾è®¯äº‘å¯¹è±¡äº‘å­˜å‚¨è¿›è¡Œä¸Šä¼ æ–‡ä»¶(Javaä¸´æ—¶ç§˜é’¥)5](./readme-img/ä½¿ç”¨è…¾è®¯äº‘å¯¹è±¡äº‘å­˜å‚¨è¿›è¡Œä¸Šä¼ æ–‡ä»¶(Javaä¸´æ—¶ç§˜é’¥)5.png)

## ä½¿ç”¨Java SDKï¼ˆå¤šé€‚ç”¨äºJavaå¼€å‘æ¡Œé¢åº”ç”¨ï¼‰

>  æ³¨æ„: Java SDK å¤§éƒ¨åˆ†éƒ½æ˜¯Fileå¯¹è±¡æ“ä½œ, ä¸è¦æƒ³ç€ç”¨ä¼ ç»™JavaæœåŠ¡ç«¯å†ä¼ ç»™COS, å‹åŠ›è¿‡å¤§, æœ‰å¤±COSçš„åˆè¡·ï¼Œä¸”è¿˜æœ‰javascript SDKã€å°ç¨‹åº SDK, å¹²å˜›è´¹é‚£ä¹ˆå¤§çš„åŠ²å»ç»™æœåŠ¡ç«¯å¢å‹å‘¢ï¼Ÿ

+ éœ€è¦ï¼šAPIå¯†åŒ™ã€bucketNameä¿¡æ¯ã€urlä¿¡æ¯ï¼ˆåŸŸå/é»˜è®¤æä¾›çš„ï¼‰

[APIå¯†åŒ™https://console.cloud.tencent.com/cam/capi](./readme-imghttps://console.cloud.tencent.com/cam/capi)

![ä½¿ç”¨è…¾è®¯äº‘å¯¹è±¡äº‘å­˜å‚¨è¿›è¡Œä¸Šä¼ æ–‡ä»¶(Javaä¸´æ—¶ç§˜é’¥)6](./readme-img/ä½¿ç”¨è…¾è®¯äº‘å¯¹è±¡äº‘å­˜å‚¨è¿›è¡Œä¸Šä¼ æ–‡ä»¶(Javaä¸´æ—¶ç§˜é’¥)6.png)

![ä½¿ç”¨è…¾è®¯äº‘å¯¹è±¡äº‘å­˜å‚¨è¿›è¡Œä¸Šä¼ æ–‡ä»¶(Javaä¸´æ—¶ç§˜é’¥)7](./readme-img/ä½¿ç”¨è…¾è®¯äº‘å¯¹è±¡äº‘å­˜å‚¨è¿›è¡Œä¸Šä¼ æ–‡ä»¶(Javaä¸´æ—¶ç§˜é’¥)7.png)

![ä½¿ç”¨è…¾è®¯äº‘å¯¹è±¡äº‘å­˜å‚¨è¿›è¡Œä¸Šä¼ æ–‡ä»¶(Javaä¸´æ—¶ç§˜é’¥)8](./readme-img/ä½¿ç”¨è…¾è®¯äº‘å¯¹è±¡äº‘å­˜å‚¨è¿›è¡Œä¸Šä¼ æ–‡ä»¶(Javaä¸´æ—¶ç§˜é’¥)8.png)

> ğŸ˜’æˆ‘æ˜¯å°è£…å®Œè‡ªå·±çš„Utilsæ‰æ„è¯†åˆ°ï¼Œè¿™ä¸çº¯çº¯æœåŠ¡ç«¯å¢å‹å·¥å…·ç±»å—ï¼Ÿ
>
> + å¦‚æœä½ æƒ³ä¼ é€’æ–‡ä»¶å¹¶è®°å½•, js sdk or å°ç¨‹åº sdkè°ƒç”¨api + javaåå°apiæ•°æ®åº“å­—æ®µè®°å½•

æ‰€ä»¥, å¦‚æœä½ æ˜¯æ¡Œé¢appï¼Œç›´æ¥å‚è€ƒ`JavaÂ SDK`å³å¯, å¾ˆç®€å•ã€‚c + vå°±å¥½

## ä½¿ç”¨javaè·å–ä¸´æ—¶ç§˜é’¥ï¼ˆä¸»è¦å†…å®¹ï¼‰

![ä½¿ç”¨è…¾è®¯äº‘å¯¹è±¡äº‘å­˜å‚¨è¿›è¡Œä¸Šä¼ æ–‡ä»¶(Javaä¸´æ—¶ç§˜é’¥)9](./readme-img/ä½¿ç”¨è…¾è®¯äº‘å¯¹è±¡äº‘å­˜å‚¨è¿›è¡Œä¸Šä¼ æ–‡ä»¶(Javaä¸´æ—¶ç§˜é’¥)9.png)

> å¦‚æœä½ æ‡’ä¸”ä¸æ€•æ°¸ä¹…ç§˜é’¥æ³„éœ², å¯ä»¥ç›´æ¥æ‰¾å¯¹åº”çš„SDKä¸Šæ‰‹å³å¯

+ Java COS STS SDK æ–‡æ¡£ï¼š[https://cloud.tencent.com/document/product/436/14048](./readme-imghttps://cloud.tencent.com/document/product/436/14048)

+ æ¶æ„æµç¨‹å›¾ï¼š

![ä½¿ç”¨è…¾è®¯äº‘å¯¹è±¡äº‘å­˜å‚¨è¿›è¡Œä¸Šä¼ æ–‡ä»¶(Javaä¸´æ—¶ç§˜é’¥)10](./readme-img/ä½¿ç”¨è…¾è®¯äº‘å¯¹è±¡äº‘å­˜å‚¨è¿›è¡Œä¸Šä¼ æ–‡ä»¶(Javaä¸´æ—¶ç§˜é’¥)10.png)

> 1. 1-2 å°ç¨‹åº || app || web  =>  æˆ‘ä»¬çš„JavaæœåŠ¡ç«¯ => è…¾è®¯çš„CAMæƒé™ç³»ç»Ÿä¸æˆ‘ä»¬çš„COSä¸´æ—¶ç§˜é’¥åŒæ­¥
> 2. 3-4 CAM => javaæœåŠ¡ç«¯ => å°ç¨‹åº || ... (æ‹¿åˆ°ä¸´æ—¶ç§˜é’¥)
> 3. 5 æºå¸¦ä¸´æ—¶ç§˜é’¥è¯·æ±‚ä¸Šä¼ ã€ä¸‹è½½æ“ä½œ...



## ä½¿ç”¨å°ç¨‹åºSDK

+ npmå®‰è£… / npmæ„å»ºå°ç¨‹åºæœ‰é—®é¢˜çš„, æˆ‘ä¹Ÿæœ‰å°ç¨‹åºæ„å»ºé—®é¢˜ï¼Œæœ€ç¬¨çš„æ–¹æ³•å°±æ˜¯ä¸‹è½½`wx-cos-sdk-v5.js`ç„¶åå¼•å…¥å³å¯

```she
npm install cos-wx-sdk-v5
```

+ å¼•å…¥

```type
const COS = require('cos-wx-sdk-v5');
```

+ é…ç½®å¾®ä¿¡å°ç¨‹åºç™½åå•

![ä½¿ç”¨è…¾è®¯äº‘å¯¹è±¡äº‘å­˜å‚¨è¿›è¡Œä¸Šä¼ æ–‡ä»¶(Javaä¸´æ—¶ç§˜é’¥)11](./readme-img/ä½¿ç”¨è…¾è®¯äº‘å¯¹è±¡äº‘å­˜å‚¨è¿›è¡Œä¸Šä¼ æ–‡ä»¶(Javaä¸´æ—¶ç§˜é’¥)11.png)

> å› ä¸ºæˆ‘è¿˜æ²¡æœ‰å°†åå°ä¸Šä¼ åˆ°æœåŠ¡å™¨, éƒ½åœ¨æœ¬åœ°æµ‹è¯•, æ‰€ä»¥è¿™é‡Œå¯ä»¥çœç•¥, åæœŸé…ç½®å³å¯
>
> è®¾ç½®: å¾®ä¿¡å¼€å‘è€…å·¥å…· -> å³ä¸Šè§’è¯¦ç»† -> æœ¬åœ°è®¾ç½® -> âœ”ä¸æ ¡éªŒåˆæ³•åŸŸå....ä»¥åŠHTTPSè¯ä¹¦

</br>

### å®˜æ–¹æ–¹æ³•ä¸€ï¼ˆæ¨èï¼‰ï¼šåç«¯é€šè¿‡è·å–ä¸´æ—¶å¯†é’¥ç»™åˆ°å‰ç«¯ï¼Œå‰ç«¯è®¡ç®—ç­¾å

1. `QCloundController.java`

```java
    // ä¸´æ—¶ç§˜é’¥é…ç½®
    TreeMap<String, Object> config = new TreeMap<String, Object>();
    Response credential = null; // å‡­è¯ç»“æœ

    try {
      config.put("SecretId", cosProperties.getSecretId());
      config.put("SecretKey", cosProperties.getSecretKey());
      config.put("durationSeconds", 1800); // è®¾ç½®å¯ä½¿ç”¨äº‹ä»¶1800ç§’ -> 30åˆ†é’Ÿ
      config.put("bucket", cosProperties.getBucketName()); // å­˜å‚¨æ¡¶å
      config.put("region", cosProperties.getRegion()); // åœ°åŒº
      // policyçš„resource => å‰ç¼€
      // åªå…è®¸è®¿é—®: [avatar/*]
      config.put("allowPrefixes", new String[] {
              cosProperties.getAvatarPrefix()
      });

      // å¯†é’¥çš„æƒé™åˆ—è¡¨ã€‚å¿…é¡»åœ¨è¿™é‡ŒæŒ‡å®šæœ¬æ¬¡ä¸´æ—¶å¯†é’¥æ‰€éœ€è¦çš„æƒé™ã€‚
      // ç®€å•ä¸Šä¼ ã€è¡¨å•ä¸Šä¼ å’Œåˆ†ç‰‡ä¸Šä¼ éœ€è¦ä»¥ä¸‹çš„æƒé™ï¼Œå…¶ä»–æƒé™åˆ—è¡¨è¯·çœ‹ https://cloud.tencent.com/document/product/436/31923
      config.put("allowActions", new String[] {
              "name/cos:PutObject",// ç®€å•ä¸Šä¼ 
              "name/cos:PostObject",// è¡¨å•ä¸Šä¼ ã€å°ç¨‹åºä¸Šä¼ 
              "name/cos:GetBucket", // å…è®¸è·å–æ¡¶çš„å¯¹è±¡åˆ—è¡¨
              // åˆ†ç‰‡ä¸Šä¼ 
              "name/cos:InitiateMultipartUpload",
              "name/cos:ListMultipartUploads",
              "name/cos:ListParts",
              "name/cos:UploadPart",
              "name/cos:CompleteMultipartUpload"
      });

      //æˆåŠŸè¿”å›ä¸´æ—¶å¯†é’¥ä¿¡æ¯ï¼Œå¦‚ä¸‹æ‰“å°å¯†é’¥ä¿¡æ¯
      credential = CosStsClient.getCredential(config);
    } catch (Exception e) {
      //å¤±è´¥æŠ›å‡ºå¼‚å¸¸
      e.printStackTrace();
      throw new IllegalArgumentException("no valid secret !");
    }
    return Result.success(credential);
```

> `allowPrefixes `å¯¹åº” policyçš„resourceï¼ˆåŸæœ¬æ˜¯allowPrefix, ä»æºç ä¸­å¯ä»¥å¾—å‡ºï¼‰
>
> `allowActions `å¯¹åº”policyçš„action
>
> policyæ›´å¤šäº†è§£ï¼š[https://cloud.tencent.com/document/product/436/31923](./readme-imghttps://cloud.tencent.com/document/product/436/31923)

![ä½¿ç”¨è…¾è®¯äº‘å¯¹è±¡äº‘å­˜å‚¨è¿›è¡Œä¸Šä¼ æ–‡ä»¶(Javaä¸´æ—¶ç§˜é’¥)12](./readme-img/ä½¿ç”¨è…¾è®¯äº‘å¯¹è±¡äº‘å­˜å‚¨è¿›è¡Œä¸Šä¼ æ–‡ä»¶(Javaä¸´æ—¶ç§˜é’¥)12.png)

	2. å†™å®Œjavaåå°å°±è¯¥å†™å‰ç«¯å°ç¨‹åºäº†

`cos.ts`

```typescript
// cos.ts
const COS = require('cos-wx-sdk-v5');


var cos = new COS({
  getAuthorization: function (options: any, callback: any) {
    console.log(options);
    
    wx.request({
      url: 'http://127.0.0.1:8080/qc/key',
      data: {
      },
      dataType: 'json',
      success: function (result: any) {
        var data = result.data.data;
        console.log(data);
        var credentials = data && data.credentials;
        if (!data || !credentials) return console.error('credentials invalid');
        callback({
          TmpSecretId: credentials.tmpSecretId,
          TmpSecretKey: credentials.tmpSecretKey,
          XCosSecurityToken: credentials.sessionToken,
          // å»ºè®®è¿”å›æœåŠ¡å™¨æ—¶é—´ä½œä¸ºç­¾åçš„å¼€å§‹æ—¶é—´ï¼Œé¿å…ç”¨æˆ·æµè§ˆå™¨æœ¬åœ°æ—¶é—´åå·®è¿‡å¤§å¯¼è‡´ç­¾åé”™è¯¯
          StartTime: data.startTime, // æ—¶é—´æˆ³ï¼Œå•ä½ç§’ï¼Œå¦‚ï¼š1580000000
          ExpiredTime: data.expiredTime, // æ—¶é—´æˆ³ï¼Œå•ä½ç§’ï¼Œå¦‚ï¼š1580000900
        });
      }
    });
  }
});

export {
  cos
}
```

`app.ts`ï¼šappæ–‡ä»¶

```typescript
import { cos } from './COS/cos';

App<IAppOption>({
  globalData: {
  },
  onLaunch() {
    cos.getBucket({
      Bucket: 'myblogspringboot-1300326898',
      Region: 'ap-nanjing',
      Prefix: 'avatar/', // è¿™é‡Œä¼ å…¥åˆ—å‡ºçš„myblogspringboot-1300326898/avatarä¸‹çš„æ‰€æœ‰æ–‡ä»¶
    }, function (err: any, data: any) {
      if (err) {
        console.log(err);
        return;
      }
      console.log(data, 2);
    });
  },
})
```

+ è¯·æ±‚ç»“æœ

![ä½¿ç”¨è…¾è®¯äº‘å¯¹è±¡äº‘å­˜å‚¨è¿›è¡Œä¸Šä¼ æ–‡ä»¶(Javaä¸´æ—¶ç§˜é’¥)13](./readme-img/ä½¿ç”¨è…¾è®¯äº‘å¯¹è±¡äº‘å­˜å‚¨è¿›è¡Œä¸Šä¼ æ–‡ä»¶(Javaä¸´æ—¶ç§˜é’¥)13.png)

### å®˜æ–¹æ–¹æ³•äºŒï¼ˆä¸æ¨èä¸Šçº¿ï¼Œæ¨èæµ‹è¯•ï¼‰ï¼šçº¯å‰ç«¯ï¼Œç®€å•

`cos.ts`

```typescript
// cos.ts
const COS = require('cos-wx-sdk-v5');

var cos = new COS({
  SecretId: 'AKIDxxxxxxxxxxxxxxxxxxxxxx', // è¿™æ˜¯ç”¨æ°¸ä¹…
  SecretKey: '0mJbdT6UdWBbmjRu75pKbeT4QXP1PYS7' // æ°¸ä¹…çš„
});

export {
  cos
}
```

> æ°¸ä¹…ç§˜é’¥è·å–æ–¹å¼ï¼š[https://console.cloud.tencent.com/cam/capi](./readme-imghttps://console.cloud.tencent.com/cam/capi)

`app.ts`ï¼šè¿˜æ˜¯ä¸€æ ·çš„

```typescript
import { cos } from './COS/cos';

App<IAppOption>({
  globalData: {
  },
  onLaunch() {
    cos.getBucket({
      Bucket: 'myblogspringboot-1300326898',
      Region: 'ap-nanjing',
      Prefix: 'avatar/', // è¿™é‡Œä¼ å…¥åˆ—å‡ºçš„myblogspringboot-1300326898/avatarä¸‹çš„æ‰€æœ‰æ–‡ä»¶
    }, function (err: any, data: any) {
      if (err) {
        console.log(err);
        return;
      }
      console.log(data, 2);
    });
  },
})
```

+ ç»“æœ

![ä½¿ç”¨è…¾è®¯äº‘å¯¹è±¡äº‘å­˜å‚¨è¿›è¡Œä¸Šä¼ æ–‡ä»¶(Javaä¸´æ—¶ç§˜é’¥)14](./readme-img/ä½¿ç”¨è…¾è®¯äº‘å¯¹è±¡äº‘å­˜å‚¨è¿›è¡Œä¸Šä¼ æ–‡ä»¶(Javaä¸´æ—¶ç§˜é’¥)14.png)

> å°†è¿™ç§é‡è¦çš„ç§˜é’¥æ”¾åœ¨å‰ç«¯è‚¯å®šä¸å®‰å…¨, æ‰€ä»¥å®˜æ–¹æ¨è`æ–¹æ³•ä¸€`

### å°ç¨‹åºSDKç®€å•ä½¿ç”¨åŠå°è£…

`utils.ts`: è‡ªå·±çš„å·¥å…·ç±»

```typescript
/**
 * utils å¸¸ç”¨å·¥å…·ç±»
 */
class Utils {

  /**
   * è·å–UUID
   * @returns 
   */
  static uuid() {
    return 'xxxxxxxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
      var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
      return v.toString(16);
    });
  }

  /**
   * æ—¥æœŸæ ¼å¼åŒ–
   * @param fmt 
   * @param date 
   * @returns 
   */
    static dateFormat(fmt: string, date: Date) {
      date instanceof Date ? '' : date = new Date(date);
  
      let ret;
      const opt: any = {
        "Y+": date.getFullYear().toString(),        // å¹´
        "m+": (date.getMonth() + 1).toString(),     // æœˆ
        "d+": date.getDate().toString(),            // æ—¥
        "H+": date.getHours().toString(),           // æ—¶
        "M+": date.getMinutes().toString(),         // åˆ†
        "S+": date.getSeconds().toString()          // ç§’
        // æœ‰å…¶ä»–æ ¼å¼åŒ–å­—ç¬¦éœ€æ±‚å¯ä»¥ç»§ç»­æ·»åŠ ï¼Œå¿…é¡»è½¬åŒ–æˆå­—ç¬¦ä¸²
      };
      for (let k in opt) {
        ret = new RegExp("(" + k + ")").exec(fmt);
        if (ret) {
          fmt = fmt.replace(ret[1], (ret[1].length == 1)
            ?
            (opt[k])
            :
            (opt[k].padStart(ret[1].length, "0")));
        };
      };
      return fmt;
    }

    /**
     * æ–‡ä»¶åè·å–éšæœºæ–‡ä»¶å  abc.jpg => abc_89dac3004cbdee7f7.jpg
     * @param filename 
     * @returns 
     */
    static randomFileName(filename: String): string {
      const separator: string = '.';
      const fileNameArr: Array<string> = filename.split(separator);
      return fileNameArr[0] + '_' + this.uuid() + '.' + fileNameArr[1];
    }
}

export {
  Utils
}
```

`cos.ts`ï¼šcosçš„å°è£…

```typescript
// cos.ts
const COS = require('cos-wx-sdk-v5');
import { Utils } from '../utils/util';
import { UploadFilesArgOP } from '../interface/index';

class MyCOS {
  public AVATAR_PREFIEX: string = 'avatar/'; // é»˜è®¤å­˜å‚¨è·¯å¾„(å¤´åƒ)
  public BASE_COS_JAVA_KEY_SERVER: string = 'http://127.0.0.1:8080/qc/key'; // java æœåŠ¡
  public BUCKET: string = 'myblogspringboot-1300326898';
  public REGION: string = 'ap-nanjing'; // åœ°åŒº
  public cos: any;

  /**
 * è·å–avatar/* ä¸‹çš„æ‰€æœ‰æ–‡ä»¶
 * @returns promise
 */
  public getBucket(): any {
    return new Promise((resolve: any): void => {
      this.cos.getBucket({
        Bucket: this.BUCKET,
        Region: this.REGION,
        Prefix: 'avatar/', // è¿™é‡Œä¼ å…¥åˆ—å‡ºçš„myblogspringboot-1300326898/avatarä¸‹çš„æ‰€æœ‰æ–‡ä»¶
      }, function (err: any, data: any) {
        err ? resolve(err) : '';
        resolve(data.Contents);
      });
    })
  }

  /**
   * ç®€å•ä¸Šä¼ æ–‡ä»¶
   * @param f 
   * @param progress 
   * @returns 
   */
  public simpleUpload(f: WechatMiniprogram.ChooseFile, progress: Function): any{
    return new Promise((resolve: (value: unknown) => void) => {
      this.cos.postObject({
        Bucket: this.BUCKET,
        Region: this.REGION,
        Key: this.AVATAR_PREFIEX + Utils.randomFileName(f.name),
        FilePath: f.path, 
        onProgress: function (progressData: any) {
          progress(progressData);
        }
      }, function (err: any, data: any) {
        resolve(err || data);
      });
    });
  }

  /**
* ä¸Šä¼ å•ä¸ªæ–‡ä»¶
* @param key æ–‡ä»¶ä¸Šä¼ è·¯å¾„
* @param path æœ¬åœ°æ–‡ä»¶è·¯å¾„
* @param taskReady å‡†å¤‡ä¸Šä¼ å›è°ƒ
* @param progress  ä¸Šä¼ è¿›åº¦å›è°ƒ
* @param fileFinish ä¸Šä¼ å®Œæˆå›è°ƒ
* @returns 
*/
  uploadFile(key: string, path: string, taskReady?: Function, progress?: Function, fileFinish?: Function): object {
    return new Promise(resolve => {
      this.cos.uploadFile({
        Bucket: this.BUCKET, /* å¿…é¡» */
        Region: this.REGION,     /* å­˜å‚¨æ¡¶æ‰€åœ¨åœ°åŸŸï¼Œå¿…é¡»å­—æ®µ */
        Key: key,              /* å¿…é¡» */
        FilePath: path,                /* å¿…é¡» */
        SliceSize: 1024 * 1024 * 20,     /* è§¦å‘åˆ†å—ä¸Šä¼ çš„é˜ˆå€¼ï¼Œè¶…è¿‡5MBä½¿ç”¨åˆ†å—ä¸Šä¼ ï¼Œéå¿…é¡» */

        // éå¿…é¡», ä¸Šä¼ ä»»åŠ¡åˆ›å»ºæ—¶çš„å›è°ƒå‡½æ•°

        onTaskReady: function (taskId: number) {
          taskReady ? taskReady(taskId) : '';
        },

        // ä¸Šä¼ æ–‡ä»¶çš„è¿›åº¦å›è°ƒå‡½æ•°, éå¿…é¡»
        onProgress: function ({ loaded, total, speed }: { loaded: number, total: number, speed: number }) {
          progress ? progress(loaded, total, speed) : '';
        },

        // æ–‡ä»¶ä¸Šä¼ å®Œæˆå›è°ƒ, éå¿…é¡»
        onFileFinish: function (err: any, data: any, options: any) {
          fileFinish ? fileFinish(err, data, options) : '';
        },

      }, function (err: any, data: any) {
        err ? resolve(err) : resolve(data);
      });
    });
  }


  /**
   * ä¸Šä¼ å¤šä¸ªæ–‡ä»¶
   * @param files 
   * @param taskReady 
   * @param progress 
   * @param fileFinish 
   * @returns 
   */
  uploadMoreFile(files: WechatMiniprogram.ChooseFile[], taskReady?: Function, progress?: Function, fileFinish?: Function) {

    // è¿­ä»£æµ…æ‹·è´
    const uploadFiles: UploadFilesArgOP[] = files.
      map((item: WechatMiniprogram.ChooseFile) => {
        return Object.assign(item, {
          FilePath: item.path,
          FileSize: item.size,
          Bucket: this.BUCKET,
          Region: this.REGION,
          Key: this.AVATAR_PREFIEX + Utils.randomFileName(item.name),
          onTaskReady(taskId: number) {
            taskReady ? taskReady(taskId) : '';
          }
        })
      });

    return new Promise((resolve: (value: unknown) => void) => {
      this.cos.uploadFiles({
        files: uploadFiles,
        SliceSize: 1024 * 1024 * 10,    /* è®¾ç½®å¤§äº10MBé‡‡ç”¨åˆ†å—ä¸Šä¼  */

        // è¿›åº¦å›è°ƒ
        onProgress: (info: any) => {
          console.log(info);
          progress ? progress(info.total, info.speed, info.percent) : '';
        },

        // å…¨éƒ¨å®Œæˆ or å‡ºé”™å›è°ƒ
        onFileFinish: (err: any, data: any, options: any) => {
          fileFinish ? fileFinish(err || data, options) : '';
        },
      }, function (err: any, data: any) {
        resolve(err || data);
      });
    })
  }

  /**
   * æ‰€æœ‰çš„COSä»»åŠ¡
   */
  allTasks(): Array<any> {
    return this.cos.getTaskList();
  }

  /**
   * æ¸…é™¤æŒ‡å®šä»»åŠ¡
   * @param taskId 
   * @returns 
   */
  clearTask(taskId: string) {
    return this.cos.cancelTask(taskId);
  }

  /**
   * æš‚åœæŒ‡å®šä»»åŠ¡
   * @param taskId 
   */
  pauseTask(taskId: string) {
    this.cos.pauseTask(taskId);
  }


  /**
   * é‡æ–°å¼€å§‹æŒ‡å®šä»»åŠ¡
   * @param taskId 
   */
  reStartTask(taskId: string) {
    this.cos.restartTask(taskId);
  }
}
const myCos: MyCOS = new MyCOS();
myCos.cos = new COS({
  getAuthorization: function (options: any, callback: any) {
    // console.log('options', options);

    wx.request({
      url: myCos.BASE_COS_JAVA_KEY_SERVER,
      data: {},
      dataType: 'json',
      success: function (result: any) {
        var data = result.data.data;
        var credentials = data && data.credentials;
        if (!data || !credentials) return console.error('å‡­è¯æ— æ•ˆ...');
        callback({
          TmpSecretId: credentials.tmpSecretId,
          TmpSecretKey: credentials.tmpSecretKey,
          XCosSecurityToken: credentials.sessionToken,
          // å»ºè®®è¿”å›æœåŠ¡å™¨æ—¶é—´ä½œä¸ºç­¾åçš„å¼€å§‹æ—¶é—´ï¼Œé¿å…ç”¨æˆ·æµè§ˆå™¨æœ¬åœ°æ—¶é—´åå·®è¿‡å¤§å¯¼è‡´ç­¾åé”™è¯¯
          StartTime: data.startTime, // æ—¶é—´æˆ³ï¼Œå•ä½ç§’ï¼Œå¦‚ï¼š1580000000
          ExpiredTime: data.expiredTime, // æ—¶é—´æˆ³ï¼Œå•ä½ç§’ï¼Œå¦‚ï¼š1580000900
        });
      }
    });
  }
})
export default myCos;

```

+ æºç 

> ç äº‘åœ°å€ï¼š
>
> Githubåœ°å€ï¼š

+ æµ‹è¯•

![ä½¿ç”¨è…¾è®¯äº‘å¯¹è±¡äº‘å­˜å‚¨è¿›è¡Œä¸Šä¼ æ–‡ä»¶(Javaä¸´æ—¶ç§˜é’¥)15](./readme-img/ä½¿ç”¨è…¾è®¯äº‘å¯¹è±¡äº‘å­˜å‚¨è¿›è¡Œä¸Šä¼ æ–‡ä»¶(Javaä¸´æ—¶ç§˜é’¥)15.png)

![ä½¿ç”¨è…¾è®¯äº‘å¯¹è±¡äº‘å­˜å‚¨è¿›è¡Œä¸Šä¼ æ–‡ä»¶(Javaä¸´æ—¶ç§˜é’¥)16](./readme-img/ä½¿ç”¨è…¾è®¯äº‘å¯¹è±¡äº‘å­˜å‚¨è¿›è¡Œä¸Šä¼ æ–‡ä»¶(Javaä¸´æ—¶ç§˜é’¥)16.png)